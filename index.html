<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sales Discovery Call Form</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background-color: #fff;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
    }

    fieldset {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
    }

    legend {
      font-weight: bold;
      font-size: 1.1em;
      color: #2c3e50;
      padding: 0 10px;
    }

    label {
      display: block;
      margin: 15px 0 5px;
      font-weight: 500;
    }

    input[type="text"],
    input[type="date"],
    input[type="file"],
    textarea {
      width: 100%;
      padding: 10px;
      margin-top: 3px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1em;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    input::placeholder,
    textarea::placeholder {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #999;
    }

    textarea {
      resize: vertical;
      white-space: pre-line;
    }

    .radio-group {
      margin-top: 10px;
    }

    .radio-group label {
      display: inline-block;
      margin-right: 20px;
    }

    button {
      background-color: #2c3e50;
      color: white;
      padding: 12px 25px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: block;
      margin: 20px auto 0;
    }

    button:hover {
      background-color: #1a242f;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Sales Discovery Call Form</h2>

    <form id="myForm">
      <!-- Client Information -->
      <fieldset>
        <legend>Client Information</legend>
        <label>Company Name:</label>
        <input type="text" name="company_name" />

        <label>Industry:</label>
        <input type="text" name="industry" />

        <label>Location:</label>
        <input type="text" name="location" />

        <label>Priority Level:</label>
        <div class="radio-group">
          <label><input type="radio" name="priority" value="High"> High</label>
          <label><input type="radio" name="priority" value="Medium"> Medium</label>
          <label><input type="radio" name="priority" value="Low"> Low</label>
        </div>
      </fieldset>

      <!-- Automation Requirements -->
      <fieldset>
        <legend>Automation Requirements & Details</legend>

        <label>Automation Goal:</label>
        <textarea class="bulleted" name="automation_goal" rows="4"></textarea>

        <label>Current Workflow:</label>
        <input type="text" name="current_workflow_text" placeholder="Describe the current process..." />
        <br /><br />
        <input type="file" name="workflow_image" accept="image/*" />

        <label>Pain Points:</label>
        <textarea class="bulleted" name="pain_points" rows="4"></textarea>

        <label>Desired Automation:</label>
        <textarea class="bulleted" name="desired_automation" rows="4"></textarea>

        <label>Volume/Frequency:</label>
        <input type="text" name="volume_frequency" placeholder="e.g., 50 invoices/day" />
      </fieldset>

      <!-- Technical Considerations -->
      <fieldset>
        <legend>Technical Considerations</legend>
        <label>Existing Apps/Tools Used:</label>
        <input type="text" name="existing_apps" />

        <label>Preferred Automation Platform:</label>
        <input type="text" name="preferred_platforms" />
      </fieldset>

      <!-- Additional Notes -->
      <fieldset>
        <legend>Additional Notes</legend>
        <textarea name="additional_notes" rows="5" placeholder="Write any additional notes here..."></textarea>
      </fieldset>

      <!-- Submitted By -->
      <fieldset>
        <legend>Submitted By</legend>

        <label>Sales Executive:</label>
        <input type="text" name="sales_exec" />

        <label>Reference Number:</label>
        <div style="display: flex; gap: 5px;">
          <input type="text" id="ref_prefix" value="MSQ-" readonly style="width: 120px;" />
          <input type="text" id="ref_number_input" name="reference_number" placeholder="YYMM-001" style="flex: 1;" />
        </div>

        <label>Date:</label>
        <input type="date" name="submitted_date" placeholder="Select date..." />
      </fieldset>

      <button type="submit">Submit Form</button>
    </form>
  </div>

  <!-- ✅ JavaScript -->
  <script>
    // Auto bullets
    document.querySelectorAll('.bulleted').forEach(textarea => {
      textarea.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          const cursorPos = this.selectionStart;
          const value = this.value;
          const before = value.substring(0, cursorPos);
          const after = value.substring(cursorPos);
          this.value = before + '\n• ' + after;
          this.selectionStart = this.selectionEnd = cursorPos + 3;
        }
      });

      textarea.addEventListener('focus', function () {
        if (this.value.trim() === '') {
          this.value = '• ';
        }
      });
    });

    // Auto-fill Reference Prefix with MSQ-YYMM-
    window.addEventListener('DOMContentLoaded', function () {
      const refPrefix = document.getElementById('ref_prefix');
      const now = new Date();
      const year = String(now.getFullYear()).slice(2); // "25"
      const month = String(now.getMonth() + 1).padStart(2, '0'); // "07"
      refPrefix.value = `MSQ-${year}${month}-`;
    });

    // Webhook submission
    document.getElementById('myForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const form = e.target;
      const data = new FormData(form);

      // Combine ref prefix + user number
      const prefix = document.getElementById('ref_prefix').value;
      const numberPart = document.getElementById('ref_number_input').value;
      data.delete('reference_number');
      data.set('reference_number', prefix + numberPart);

      fetch('https://hook.eu1.make.com/rg3z1xzvpwby5jriaytgooq2dxs8kr1k', {
        method: 'POST',
        body: data
      })
      .then(response => {
        if (response.ok) {
          window.location.href = "success.html";
        } else {
          alert('Error submitting form.');
        }
      })
      .catch(err => {
        alert('Failed to submit form: ' + err.message);
      });
    });
  </script>
</body>
</html>
